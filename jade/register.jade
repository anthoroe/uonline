extends layout
block title
	Регистрация
block content
	.page-header
		h1 Регистрация
	if error === true
		.alert.alert-error
			a.close(href='#', data-dismiss='alert') &times;
			if loginIsBusy === true
				b Извините! Это имя уже занято.
				| #{' '}Придумайте какое-нибудь другое.
			else
				b Ой! Во введённых данных что-то не так.
				| #{' '}Исправьте ошибки и попробуйте ещё раз.
	form.form-horizontal(method='post', action='/register/')
		#user-control-group.control-group(class=((invalidLogin || loginIsBusy)?'error':''))
			label.control-label(for='user') Логин
			.controls
				input#user(type='text', name='user', maxlength='32', value=user, required, autofocus)
				span.help-inline
					small От 2 до 32 символов, [a-zA-Z0-9а-яА-Я_- ].
		#password-control-group.control-group(class=(invalidPass?'error':''))
			label.control-label(for='pass') Пароль
			.controls
				input#pass(type='password', name='pass', maxlength='32', required)
				span.help-inline
					a#revealpass.btn.btn-small(title='Показать пароль')
						i.icon-eye-open
					small #{' '}От 4 до 32 символов, [a-zA-Z0-9!@#$%^&amp;*()_+]
		.control-group
			.controls
				button.btn(type='submit') Зарегистрироваться
	script(src='/browserified/validation.min.js')
	script.
		$("#revealpass").click(function(){
			if ($("input[name=pass]").prop("type")=="password")
			{
				$("input[name=pass]").prop("type","text");
			}
			else
			{
				$("input[name=pass]").prop("type","password");
			}
		});
		$("input[name=user]").change(function(){
			if (validation.usernameIsValid($("input[name=user]").val()))
			{
				$("#user-control-group").removeClass("error");
			}
			else
			{
				$("#user-control-group").addClass("error");
			}
		});
		$("input[name=pass]").change(function(){
			if (validation.passwordIsValid($("input[name=pass]").val()))
			{
				$("#password-control-group").removeClass("error");
			}
			else
			{
				$("#password-control-group").addClass("error");
			}
		});
		$("input[name=user]").change(function(){
			$.getJSON("/ajax/isNickBusy/"+encodeURIComponent($("input[name=user]").val()), function(data){
				if (data.isNickBusy && (data.nick == $("input[name=user]").val()))
				{
					$("#user-control-group").addClass("error");
				}
				else
				{
					$("#user-control-group").removeClass("error");
				}
			});
		});
